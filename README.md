# 改进日历
未完成 日历每日刷题信息查询
未完成 注册功能完善



# 使用模板初始项目

- Spring Boot 2.7.x（贼新）
- Spring MVC
- MyBatis + MyBatis Plus 数据访问（开启分页）
- Spring Boot 调试工具和项目处理器
- Spring AOP 切面编程
- Spring Scheduler 定时任务
- Spring 事务注解

**数据存储**
- MySQL 数据库
- Redis 内存数据库
- Elasticsearch 搜索引擎
- 腾讯云 COS 对象存储
- 
**工具类**
- Easy Excel 表格处理
- Hutool 工具库
- Apache Commons Lang3 工具类
- Lombok 注解

**功能**
- 业务代码生成器（支持自动生成 Service、Controller、数据模型代码）
- Spring Session Redis 分布式登录
- 全局请求响应拦截器（记录日志）
- 全局异常处理器
- 自定义错误码
- 封装通用响应类
- Swagger + Knife4j 接口文档
- 自定义权限注解 + 全局校验
- 全局跨域处理
- 长整数丢失精度解决
- 多环境配置


# 通用模块开发
用户注册登录  
题库模块  
题目模块  

# 功能扩展  
用户刷题记录日志  
用户每日首次浏览题目 视为签到，记录在系统  
用户可以以图标的形式查看自己在某个年份的刷题签到记录  

使用基于redis的方案，存储用户签到记录  
使用Bitmap数据结构  
bitmap位图是一种用bit来表示数据紧凑数据结构，每个位可以存储两个值 0或1
常用于表示某种状态，因为每个位仅占用1位内存，在大规模存储二进制数据的时候效果非常好

对于刷题签到记录场景，一个用户存储一年的数据仅占用46字节 因为46*8=368位 能覆盖365天的记录  
那一百万用户也才占用43.8MB 相比redis的set结构节约了40多倍的存储空间

流程：  
每日添加签到记录  
获取-先拿到redis的bitset 然后要把bitset赋值给java的bitset对象缓存到内存中 提高性能  
只返回签到了的记录 不反回未签到的记录  


# 批量题目管理
使用线程池 分批处理 避免长事务  
自定义IO密集型线程池 + completableFuture异步处理 优化批量添加题目的性能  

# 自动缓存热门题目  
使用热key探索 自动发现热点 把数据做多级缓存来顶住大流量的访问  
统计一段时间内题库的访问次数  
访问频率超过一定阈值，变为热点数据  
缓存热点数据  
后续访问时，从缓存中获取数据  
这里使用**京东hotkey**实现自动缓存热门题目  

该框架是一个轻量级通用热key探索中间件，目的是基于突发热key状况，解决热点数据导致存储层雪崩难题  
可在0.5-2秒内将热数据，如redis热key，黑名单用户，爬虫刷接口，热接口探测出来，并推送到jvm内存  
直接将热数据放在server层内存进行缓存，极大的减少了对下游访问，redis，mysql等的冲击

**hotkey原理**  
worker： 分布式集群，单机qps按照16w计算，根据每秒待测key数量来设置worker数量，基于滑动窗口计算，根据dashboard李配置的rule规则，进行热key推送
dashboard控制台：查看实例和worker状态，查看修改热key规则配置信息，查看各维度统计信息，如热key频率，已缓存的数量，将要持久化的数据，存入mysql

1. 给worker上报字节信息到ETCD，并维持心跳
2. 服务端去EDCT拉取并监听各worker的ip和变更信息，监听热key规则配置变更信息，来觉得上报哪些key
3. 建立和各worker的长连接，基于netty，将要探测的key按hash算法，分发到不同的worker进行计算
4. worker推送探测出的热key到各实例，实例收到热key信息，在jvm进行缓存











